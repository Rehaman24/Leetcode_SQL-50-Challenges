-- Problem: Average Selling Price
-- LeetCode Link: https://leetcode.com/problems/average-selling-price/
-- Approach: 
--   1. Join Prices and UnitsSold on product_id, ensuring purchase_date is within the price period.
--   2. Calculate revenue as SUM(price * units) and total units as SUM(units).
--   3. Divide revenue by units to get average price, round to 2 decimal places.
--   4. Use COALESCE/IFNULL to return 0 when there are no sales.

# Write your MySQL query statement below

select p.product_id,
ifnull(round(sum(p.price * u.units) / sum(u.units),2),0) as average_price
from prices p left join unitssold u on 
p.product_id = u.product_id
where u.purchase_date between p.start_date and p.end_date
group by p.product_id
